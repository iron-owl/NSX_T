# Введение в NSX-T

## Основные возможности NSX-T

**NSX-T** — это реализация программно-определяемых сетей (**SDN**), которая предлагает полный стек виртуализации сети (**NV - Network Virtualization**).

### Возможности платформы

* **Конфигурация на основе политик (Policy-driven configuration)**: Автоматизация через **REST API** для упрощения настройки.
* **Поддержка нескольких гипервизоров**: Работает с **ESXi** и **KVM**.
* **Поддержка bare-metal серверов**: Расширяет сетевые и защитные сервисы на физические серверы с ОС (RHEL, CentOS, Oracle Linux, SUSE, Windows Server, Ubuntu) через установку агента NSX-T.
* **Поддержка ВМ и контейнеров**: Предоставляет сетевые сервисы и сервисы безопасности для виртуальных машин и контейнеров.
* **Поддержка публичных облаков**: **NSX Cloud** обеспечивает сети и безопасность для приложений в **Amazon AWS** и **Microsoft Azure**.
* **Независимость от vCenter Server**: Можно использовать несколько vCenter Server для управления хостами.
* **Управление через HTML 5 UI**: Графический пользовательский интерфейс для управления.
* **DPDK (Data Plane Development Kit)**: Набор библиотек для быстрой обработки пакетов, повышающий производительность.
* **Мультисайт и Федерация (Multisite and Federation)**: Позволяет развертывать распределённые сетевые сервисы и сервисы безопасности между несколькими сайтами.

---

## Сетевые функции

* **Логическая коммутация (Logical switching)**: Сегменты Layer 2, поддерживаемые **оверлеем (GENEVE)** или **VLAN**.
* **Мост Layer 2 (Layer 2 bridging)**: Объединяет сети, основанные на VLAN и оверлее (GENEVE).
* **Распределенная маршрутизация (Distributed routing)**: Функциональность маршрутизации внедряется во все узлы-транспорты хоста (гипервизоры).
* **Статическая маршрутизация и ECMP**: Поддержка **Equal-Cost Multi-Path (ECMP)** для исходящего и входящего трафика.
* **BGP (Border Gateway Protocol)**: Поддержка динамического обмена маршрутами.
* **BFD (Bidirectional Forwarding Detection)**: Протокол для быстрого обнаружения сбоев.
* **VRF Lite (Virtual Routing Forwarding)**: Позволяет сосуществовать нескольким разделенным экземплярам маршрутизации в одном шлюзе.
* **EVPN (Ethernet Virtual Private Network)**: Расширяет связность Layer 2 и Layer 3 между ЦОД.
* **Layer 3 multicast**: Поддержка многоадресной рассылки.

> **GENEVE** — это протокол инкапсуляции, используемый в NSX-T, который, как и **VXLAN** в NSX-v, создаёт оверлейные сети. Однако GENEVE более гибкий, имеет расширяемый заголовок для передачи дополнительной информации.

---

## Функции безопасности и сервисов

* **Шлюзовой межсетевой экран (Gateway firewall)**: Обеспечивает межсетевое экранирование типа "север-юг".
* **Распределенный межсетевой экран (Distributed firewall)**: Обеспечивает межсетевое экранирование типа "восток-запад", применяя политики безопасности на уровне ВМ.
* **Распределенное обнаружение/предотвращение вторжений (Distributed IDS/IPS)**: Сервисы обнаружения/предотвращения вторжений, работающие распределённо.
* **Микросегментация (Micro-Segmentation)**: Реализация безопасности по модели **Zero-Trust** внутри виртуальной сети.
* **NAT и NAT64**: Поддержка трансляции IPv4 в IPv4, а также IPv6 в IPv4.
* **DHCP-сервер и ретранслятор**: Сервисы динамического распределения IP-адресов.
* **Балансировщик нагрузки (Load balancer)**: Распределение сетевого трафика по нескольким серверам.
* **VPN**: Поддержка **L2 VPN** и **IPSec VPN**.

---

## Варианты использования NSX-T

### Для безопасности

* **Микросегментация**: Обеспечение безопасности по модели Zero-Trust.
* **DMZ Anywhere**: Размещение рабочих нагрузок **DMZ** на том же оборудовании, что и другие, но с изолированной политикой безопасности.
* **Безопасность для конечных пользователей**: Применение политик безопасности на основе учётных данных пользователя (**Active Directory**).

### Для автоматизации

* **Автоматизация IT**: Использование **REST API** для автоматизации операций **CRUD** (Create, Read, Update, Delete) через такие инструменты, как **Ansible**, **Terraform**, **PowerCLI**.
* **Developer Cloud**: Быстрое развёртывание и удаление сетевых ресурсов для разработчиков.
* **Многоарендная инфраструктура (Multi-Tenant)**: Автоматическое развёртывание изолированных сетевых топологий для разных арендаторов.

### Для сетей с несколькими облаками

* **Аварийное восстановление (Disaster Recovery)**: Автоматическое перемещение сетевых сервисов и сервисов безопасности вместе с рабочими нагрузками.
* **Объединение центров обработки данных**: Расширение сетевых сервисов на несколько сайтов.
* **Гибридные облачные сети**: Унифицированное управление сетью в публичных облаках (**VMC on AWS**, **Azure VMware Solution**).
* **Облачные нативные приложения**: Интегрированная сеть и безопасность для контейнерных приложений и микросервисов.

---

## Высокоуровневая архитектура NSX-T

NSX-T разделяет архитектуру на три плоскости:

* **Плоскость управления (Management plane)**: Отвечает за управление конфигурацией. Реализована в кластере **NSX-T Manager**.
* **Плоскость контроля (Control plane)**: Определяет, как пакеты должны пересылаться. Состоит из **Central Control Plane (CCP)** внутри NSX-T Manager и **Local Control Plane (LCP)** на транспортных узлах.
* **Плоскость данных (Data plane)**: Отвечает за фактическую пересылку пакетов. Состоит из **транспортных узлов** (**Transport Nodes**): узлов-транспортов хоста (**Hypervisor transport node**) и узлов-транспортов Edge (**Edge transport node**).

### Кластер NSX-T Manager

Кластер состоит из трёх узлов NSX-T Manager для высокой доступности. Можно использовать внутренний **VIP (Virtual IP)** для перенаправления трафика на узел-лидер или внешний балансировщик нагрузки для распределения трафика.

### Роли и взаимодействие

* **Роль политики (NSX-T Policy Role)**: Единая точка входа для настройки сети и безопасности.
* **Роль менеджера (NSX-T Manager Role)**: Получает и проверяет конфигурацию от роли политики, затем отправляет её в **CCP**.
* **Роль контроллера (NSX-T Controller Role)**: Вычисляет текущее состояние системы и настраивает компоненты плоскости данных.

Компоненты NSX-T Manager обмениваются данными и хранят информацию в постоянном хранилище объектов **CorfuDB**.

### Плоскость данных

* **Узлы-транспорты хоста**: Гипервизоры **ESXi** и **KVM**, которые пересылают трафик виртуальных машин.
* **Узлы-транспорты Edge**: Виртуальные или физические узлы, размещающие шлюзы **Tier-0** и **Tier-1** и предоставляющие сервисы с сохранением состояния (например, NAT, VPN).

Плоскость управления и контроля взаимодействует с транспортными узлами по протоколу **NSX-RPC**.
